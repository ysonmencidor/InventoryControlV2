#pragma checksum "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "612bd99dfc9a3d79350a9fd5eb981c5e7911e792"
// <auto-generated/>
#pragma warning disable 1591
namespace ICV2_Web.Pages.Qne
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using ICV2_Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using ICV2_Web.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using ICV2_Web.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using ICV2_Web.Authentication;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using ICV2_Web.Pages;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using DataAccessLibrary.Models.QneModels;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using DataAccessLibrary.Models.QneReportFilter;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using DataAccessLibrary.Models.QneReportResult;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using DataAccessLibrary.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using DataAccessLibrary;

#line default
#line hidden
#nullable disable
#nullable restore
#line 21 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Blazorise;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Blazorise.Icons;

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using ICV2_Web.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 28 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using NEvaldas.Blazor.Select2;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
using System.Text.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
using ClosedXML.Excel;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
using ICV2_Web.JSHelper;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
           [Authorize(Roles = "Administrator,User")]

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/MaterialConsumption")]
    public partial class MaterialConsumption : Microsoft.AspNetCore.Components.ComponentBase, IDisposable
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
#nullable restore
#line 13 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
 if (AppState.CompanyReady())
{

#line default
#line hidden
#nullable disable
            __builder.OpenElement(0, "div");
            __builder.AddAttribute(1, "class", "card shadow");
#nullable restore
#line 16 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
         if (formModel != null)
        {

#line default
#line hidden
#nullable disable
            __builder.OpenComponent<Microsoft.AspNetCore.Components.Forms.EditForm>(2);
            __builder.AddAttribute(3, "id", "MyForm");
            __builder.AddAttribute(4, "Model", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.Object>(
#nullable restore
#line 18 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                         formModel

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(5, "OnSubmit", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<Microsoft.AspNetCore.Components.EventCallback<Microsoft.AspNetCore.Components.Forms.EditContext>>(Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Forms.EditContext>(this, 
#nullable restore
#line 18 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                                              GenerateReport

#line default
#line hidden
#nullable disable
            )));
            __builder.AddAttribute(6, "ChildContent", (Microsoft.AspNetCore.Components.RenderFragment<Microsoft.AspNetCore.Components.Forms.EditContext>)((context) => (__builder2) => {
                __builder2.AddMarkupContent(7, "<div class=\"card-header bg-secondary text-white \">\r\n                    Material Consumption Reports\r\n                </div>\r\n                ");
                __builder2.OpenElement(8, "div");
                __builder2.AddAttribute(9, "class", "card-body");
                __builder2.OpenElement(10, "div");
                __builder2.AddAttribute(11, "class", "form-group row");
                __builder2.AddMarkupContent(12, "<label for=\"stockAsem\" class=\"col-sm-2 col-form-label\">Stock </label>\r\n                        ");
                __builder2.OpenElement(13, "div");
                __builder2.AddAttribute(14, "class", "col-sm-4");
                __Blazor.ICV2_Web.Pages.Qne.MaterialConsumption.TypeInference.CreateInputSelect_0(__builder2, 15, 16, "stockAsem", 17, Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.ChangeEventArgs>(this, 
#nullable restore
#line 26 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                                                  StCodeOnchange

#line default
#line hidden
#nullable disable
                ), 18, "form-control", 19, 
#nullable restore
#line 26 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                                                                               formModel.StockId

#line default
#line hidden
#nullable disable
                , 20, Microsoft.AspNetCore.Components.EventCallback.Factory.Create(this, Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.CreateInferredEventCallback(this, __value => formModel.StockId = __value, formModel.StockId)), 21, () => formModel.StockId, 22, (__builder3) => {
                    __builder3.AddMarkupContent(23, "<option value=\"%%\">- Please select stock -</option>");
#nullable restore
#line 28 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                 if (stocks is not null)
                                        {
                                    

#line default
#line hidden
#nullable disable
#nullable restore
#line 30 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                     foreach (var item in stocks)
                                            {

#line default
#line hidden
#nullable disable
                    __builder3.OpenElement(24, "option");
                    __builder3.AddAttribute(25, "value", 
#nullable restore
#line 32 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                                        item.Id

#line default
#line hidden
#nullable disable
                    );
                    __builder3.AddContent(26, 
#nullable restore
#line 32 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                                                  item.StockCode

#line default
#line hidden
#nullable disable
                    );
                    __builder3.AddContent(27, " - ");
                    __builder3.AddContent(28, 
#nullable restore
#line 32 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                                                                    item.StockName

#line default
#line hidden
#nullable disable
                    );
                    __builder3.CloseElement();
#nullable restore
#line 33 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                            }

#line default
#line hidden
#nullable disable
#nullable restore
#line 33 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                             
                                        }

#line default
#line hidden
#nullable disable
                }
                );
                __builder2.CloseElement();
                __builder2.AddMarkupContent(29, "\r\n                        ");
                __builder2.AddMarkupContent(30, "<label for=\"AsemCOde\" class=\"col-sm-2 col-form-label\">Assembly Code </label>\r\n                        ");
                __builder2.OpenElement(31, "div");
                __builder2.AddAttribute(32, "class", "col-sm-4");
                __Blazor.ICV2_Web.Pages.Qne.MaterialConsumption.TypeInference.CreateInputSelect_1(__builder2, 33, 34, "AsemCOde", 35, "form-control", 36, 
#nullable restore
#line 39 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                                                    formModel.AssemblyCode

#line default
#line hidden
#nullable disable
                , 37, Microsoft.AspNetCore.Components.EventCallback.Factory.Create(this, Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.CreateInferredEventCallback(this, __value => formModel.AssemblyCode = __value, formModel.AssemblyCode)), 38, () => formModel.AssemblyCode, 39, (__builder3) => {
#nullable restore
#line 40 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                 if (stockAssemblies is not null && stockAssemblies.Count() > 0)
                                        {

#line default
#line hidden
#nullable disable
                    __builder3.AddMarkupContent(40, "<option value=\"%%\">All</option>");
#nullable restore
#line 43 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                         foreach (var item in stockAssemblies)
                                            {

#line default
#line hidden
#nullable disable
                    __builder3.OpenElement(41, "option");
                    __builder3.AddAttribute(42, "value", 
#nullable restore
#line 45 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                                        item.AssemblyCode

#line default
#line hidden
#nullable disable
                    );
                    __builder3.AddContent(43, 
#nullable restore
#line 45 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                                                            item.AssemblyCode

#line default
#line hidden
#nullable disable
                    );
                    __builder3.CloseElement();
#nullable restore
#line 46 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                            }

#line default
#line hidden
#nullable disable
#nullable restore
#line 46 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                             
                                        }
                                        else
                                        {

#line default
#line hidden
#nullable disable
                    __builder3.AddMarkupContent(44, "<option value=\"%%\">-</option>");
#nullable restore
#line 51 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
                                        }

#line default
#line hidden
#nullable disable
                }
                );
                __builder2.CloseElement();
                __builder2.CloseElement();
                __builder2.CloseElement();
                __builder2.AddMarkupContent(45, "\r\n                ");
                __builder2.AddMarkupContent(46, "<div class=\"card-footer\"><div class=\"d-flex justify-content-end\"><button type=\"submit\" class=\"btn btn-outline-info\">Generate Report</button></div></div>");
            }
            ));
            __builder.CloseComponent();
#nullable restore
#line 62 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
        }

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
#nullable restore
#line 64 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"

}
else
{

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(47, "<div class=\"col-6\"><h4 class=\"alert alert-info text-center shadow\">SELECT COMPANY FIRST</h4></div>");
#nullable restore
#line 71 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
}

#line default
#line hidden
#nullable disable
        }
        #pragma warning restore 1998
#nullable restore
#line 74 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Qne\MaterialConsumption.razor"
       

    //IJSObjectReference module;

    MATERIALCONSUMPTIONFILTER formModel = new();
    //private bool Submited = false;
    private List<Stocks> stocks { get; set; } = new List<Stocks>();
    private List<StockAssembly> stockAssemblies { get; set; } = new List<StockAssembly>();
    private IEnumerable<StockLocations> Location { get; set; }
    //private IEnumerable<BATCHNOBALANCEDETAILSRESULT> result { get; set; }
    List<BATCHNOBALANCEDETAILSRESULT> Result = new List<BATCHNOBALANCEDETAILSRESULT>();
    private List<Company> companies { get; set; }
    private string CompCode { get; set; }

    private async Task StCodeOnchange(ChangeEventArgs e)
    {
        if (e.Value.ToString() != "%%")
        {
            Console.WriteLine(e.Value.ToString());

            string stockId = e.Value.ToString();

            var httpRequest = await http.GetAsync($"api/Qne/GetStockAssemblyCodes?companyCode={CompCode}&StockId={stockId}");

            if (httpRequest.IsSuccessStatusCode)
            {
                var responseString = await httpRequest.Content.ReadAsStringAsync();

                stockAssemblies = JsonSerializer.Deserialize<List<StockAssembly>>(responseString,
                 new JsonSerializerOptions() { PropertyNameCaseInsensitive = true });
            }
        }
        else if(e.Value.ToString() == "%%")
        {
            stockAssemblies.Clear();
        }
    }

    protected override async Task OnInitializedAsync()
    {
        if (AppState.CompanyReady())
        {
            await LoadData();
        }
    }

    private async Task LoadData()
    {
        CompCode = AppState.selectedCompanyCode;
        companies = await http.GetFromJsonAsync<List<Company>>("api/Navigation/GetCompany");
        stocks = await http.GetFromJsonAsync<List<Stocks>>("api/Qne/GetStockAssembly?companyCode=" + CompCode);
    }
    private async Task GenerateReport()
    {
        formModel.CompanyCode = AppState.selectedCompanyCode;

        var httpRequest = await http.PostAsJsonAsync("api/Report/GenerateMaterialConsumptions", formModel);

        if (httpRequest.IsSuccessStatusCode)
        {
            var responseString = await httpRequest.Content.ReadAsStringAsync();

            //Console.WriteLine(responseString);

            //Console.WriteLine(responseString);
            var data = JsonSerializer.Deserialize<List<MATERIALCONSUMPTIONRESULT>>(responseString,
              new JsonSerializerOptions() { PropertyNameCaseInsensitive = true });

            await GenerateExcel(data);
        }
    }

    private async Task GenerateExcel(List<MATERIALCONSUMPTIONRESULT> data)
    {
        string company_name = companies.Where(y => y.Code == formModel.CompanyCode).Select(x => x.Name).First();
        using (XLWorkbook wb = new XLWorkbook())
        {


            string mbr_no = Convert.ToString(formModel.AssemblyCode).Trim();

            //sql variables
            string RETENTION_LOCATION_CODE = "FG - QA RETENTION";
            string STABILITY_LOCATION_CODE = "FG-QA STABILITY";

            //report variables
            string PRODUCTNAME = "";

            DateTime MFG_DATE = new DateTime();
            DateTime EXP_DATE = new DateTime();
            string BATCH_NO = mbr_no;
            double RETENTION_QTY = 0;
            string RETENTION_UOM = "";
            double STABILITY_QTY = 0;
            string STABILITY_UOM = "";
            double FGP_QTY = 0;
            string FGP_UOM = "";


            string queryString = "";
            string reportFileName = "";
            List<MATERIALCONSUMPTIONRESULT> rmList = new List<MATERIALCONSUMPTIONRESULT>();
            List<MATERIALCONSUMPTIONRESULT> pmList = new List<MATERIALCONSUMPTIONRESULT>();
            List<MATERIALCONSUMPTIONRESULT> fgList = new List<MATERIALCONSUMPTIONRESULT>();

            reportFileName = "_MATERIAL_CONSUMPTION";


            foreach (var item in data)
            {
                //if (String.IsNullOrEmpty(PRODUCTNAME))
                //{

                //    PRODUCTNAME = fbDataReader["PRODUCTNAME"].ToString().Trim();
                //    if (!String.IsNullOrEmpty(fbDataReader["BNMANUFACTURINGDATE"].ToString()))
                //    {
                //        MFG_DATE = Convert.ToDateTime(fbDataReader["BNMANUFACTURINGDATE"].ToString().Trim());
                //    }
                //    if (!String.IsNullOrEmpty(fbDataReader["BATCHNOEXPIRYDATE"].ToString()))
                //    {
                //        EXP_DATE = Convert.ToDateTime(fbDataReader["BATCHNOEXPIRYDATE"].ToString().Trim());
                //    }
                //    if (!String.IsNullOrEmpty(fbDataReader["RETENTION"].ToString()))
                //    {
                //        RETENTION_QTY = Convert.ToDouble(fbDataReader["RETENTION"].ToString().Trim());
                //    }
                //    if (!String.IsNullOrEmpty(fbDataReader["RETENTION_UOM"].ToString()))
                //    {
                //        RETENTION_UOM = fbDataReader["RETENTION_UOM"].ToString().Trim();
                //    }
                //    if (!String.IsNullOrEmpty(fbDataReader["STABL"].ToString()))
                //    {
                //        STABILITY_QTY = Convert.ToDouble(fbDataReader["STABL"].ToString().Trim());
                //    }
                //    if (!String.IsNullOrEmpty(fbDataReader["STABL_UOM"].ToString()))
                //    {
                //        STABILITY_UOM = fbDataReader["STABL_UOM"].ToString().Trim();
                //    }
                //    if (!String.IsNullOrEmpty(fbDataReader["FG_QTY"].ToString()))
                //    {
                //        FGP_QTY = Convert.ToDouble(fbDataReader["FG_QTY"].ToString().Trim());
                //    }
                //    if (!String.IsNullOrEmpty(fbDataReader["FG_UOM"].ToString()))
                //    {
                //        FGP_UOM = fbDataReader["FG_UOM"].ToString().Trim();
                //    }

                //}


                if (String.Equals(item.GroupCode, "RM"))
                {

                    rmList.Add(new MATERIALCONSUMPTIONRESULT
                    {
                        BatchNo = item.BatchNo,
                        STOCKCODE = item.STOCKCODE,
                        DESCRIPTION = item.DESCRIPTION,
                        QTY = item.QTY,
                        UOM = item.UOM,
                        COST = item.COST,
                        AMOUNT = item.AMOUNT,
                        ASSEMBLYCODE = item.ASSEMBLYCODE,
                        GroupCode = item.GroupCode
                    });
                }
                else if (String.Equals(item.GroupCode, "FG"))
                {
                    fgList.Add(new MATERIALCONSUMPTIONRESULT
                    {
                        BatchNo = item.BatchNo,
                        STOCKCODE = item.STOCKCODE,
                        DESCRIPTION = item.DESCRIPTION,
                        QTY = item.QTY,
                        UOM = item.UOM,
                        COST = item.COST,
                        AMOUNT = item.AMOUNT,
                        ASSEMBLYCODE = item.ASSEMBLYCODE,
                        GroupCode = item.GroupCode
                    });
                }
                else
                {
                    pmList.Add(new MATERIALCONSUMPTIONRESULT
                    {
                        BatchNo = item.BatchNo,
                        STOCKCODE = item.STOCKCODE,
                        DESCRIPTION = item.DESCRIPTION,
                        QTY = item.QTY,
                        UOM = item.UOM,
                        COST = item.COST,
                        AMOUNT = item.AMOUNT,
                        ASSEMBLYCODE = item.ASSEMBLYCODE,
                        GroupCode = item.GroupCode
                    });
                }



            }

            IXLWorksheet ws = wb.Worksheets.Add("MATERIAL CONSUMPTION");

            //CELL VARIABLES
            IXLAddress RM_TOTAL_CELL;
            IXLAddress PM_TOTAL_CELL;
            IXLAddress FGP_QTY_CELL;
            IXLAddress RETENTION_QTY_CELL;
            IXLAddress STABILITY_QTY_CELL;
            IXLAddress FG_AVAILABLE_FOR_SALE_CELL;
            IXLAddress TOLL_FEE_CELL;

            IXLAddress RM_COST_PER_BATCH;
            IXLAddress PM_COST_PER_BATCH;
            IXLAddress TOLL_FEE_PER_BATCH;
            IXLAddress ASSAY_FEE;
            IXLAddress RM_COST_PER_UNIT;
            IXLAddress PM_COST_PER_UNIT;
            IXLAddress TOLL_FEE_PER_UNIT;
            IXLAddress TOTAL_PER_UNIT;
            //HEADER
            IXLCell cell = ws.Cell("A1").SetValue(company_name);
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Font.Bold = true;
            cell = ws.Cell("A2").SetValue("MATERIAL CONSUMPTION REPORT");
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Font.Bold = true;

            //SUB HEADER
            cell = ws.Cell("A4").SetValue("PRODUCT NAME:");
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("B4").SetValue(PRODUCTNAME);
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("G4").SetValue("MBR NO:");
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("H4").SetValue(BATCH_NO.ToString());
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("A5").SetValue("MFG DATE:");
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("B5").SetValue(MFG_DATE.ToString("MMM-yyyy"));
            cell.Style.Font.Bold = true;
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Left);
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("G5").SetValue("EXP DATE:");
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("H5").SetValue(EXP_DATE.ToString("MMM-yyyy"));
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Left);


            //DETAIL - TITLE

            cell = ws.Cell("A7").SetValue("CODE");
            cell.Style.Font.Bold = true;
            cell = ws.Cell("B7").SetValue("DESCRIPTION");
            cell.Style.Font.Bold = true;
            cell = ws.Cell("C7").SetValue("QTY");
            cell.Style.Font.Bold = true;
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
            cell = ws.Cell("D7").SetValue("UOM");
            cell.Style.Font.Bold = true;
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);
            cell = ws.Cell("E7").SetValue("U.COST");
            cell.Style.Font.Bold = true;
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
            cell = ws.Cell("F7").SetValue("AMOUNT");
            cell.Style.Font.Bold = true;
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
            cell = ws.Cell("G7").SetValue("REF#");
            cell.Style.Font.Bold = true;
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);
            cell = ws.Cell("H7").SetValue("DATE ISSUED");
            cell.Style.Font.Bold = true;
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
            cell = ws.Cell("I7").SetValue("BATCH NO");
            cell.Style.Font.Bold = true;
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);

            int rowNumber = 8;
            int count = 1;
            double rm_total = 0;
            double pm_total = 0;
            double fg_total = 0;
            foreach (MATERIALCONSUMPTIONRESULT si in rmList)
            {

                cell = ws.Cell("A" + rowNumber).SetValue(si.STOCKCODE);
                cell = ws.Cell("B" + rowNumber).SetValue(si.DESCRIPTION);
                cell = ws.Cell("C" + rowNumber).SetValue(si.QTY);
                cell.Style.NumberFormat.Format = "#,##0.0000";
                cell = ws.Cell("D" + rowNumber).SetValue(si.UOM);
                cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);
                if (si.COST > 0)
                {
                    cell = ws.Cell("E" + rowNumber).SetValue(si.COST);
                    cell.Style.NumberFormat.Format = "#,##0.00000000";
                }
                else
                {
                    cell = ws.Cell("E" + rowNumber).SetValue("-");
                    cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
                }

                cell = ws.Cell("F" + rowNumber).SetValue(si.AMOUNT);
                cell.Style.NumberFormat.Format = "#,##0.00";
                //cell = ws.Cell("G" + rowNumber).SetValue(si.REFNO);
                //cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);
                //cell = ws.Cell("H" + rowNumber).SetValue(si.DATEISSUED);
                //cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
                cell = ws.Cell("I" + rowNumber).SetValue(si.BatchNo);
                cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
                rowNumber++;
                count++;
                rm_total += si.AMOUNT;
            }
            //set last AMOUNT cell border
            cell = ws.Cell("F" + (rowNumber - 1));
            cell.Style.Border.BottomBorder = XLBorderStyleValues.Thin;

            cell = ws.Cell("A" + rowNumber).SetValue("Total Raw Materials Cost");
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("F" + rowNumber).SetValue(rm_total);
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            RM_TOTAL_CELL = cell.Address;//get rm total cell address

            rowNumber += 2;

            foreach (MATERIALCONSUMPTIONRESULT si in pmList)
            {

                cell = ws.Cell("A" + rowNumber).SetValue(si.STOCKCODE);
                cell = ws.Cell("B" + rowNumber).SetValue(si.DESCRIPTION);
                cell = ws.Cell("C" + rowNumber).SetValue(si.QTY);
                if ((si.QTY - Math.Truncate(si.QTY)) > 0)
                {
                    cell.Style.NumberFormat.Format = "#,##0.00";
                }
                else
                {
                    cell.Style.NumberFormat.Format = "#,##0";
                }


                cell = ws.Cell("D" + rowNumber).SetValue(si.UOM);
                cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);

                if (si.COST > 0)
                {
                    cell = ws.Cell("E" + rowNumber).SetValue(si.COST);
                    cell.Style.NumberFormat.Format = "#,##0.00000000";
                }
                else
                {
                    cell = ws.Cell("E" + rowNumber).SetValue("-");
                    cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
                }
                cell = ws.Cell("F" + rowNumber).SetValue(si.AMOUNT);
                cell.Style.NumberFormat.Format = "#,##0.00";
                //cell = ws.Cell("G" + rowNumber).SetValue(si.REFNO);
                //cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);
                //cell = ws.Cell("H" + rowNumber).SetValue(si.DATEISSUED);
                //cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
                cell = ws.Cell("I" + rowNumber).SetValue(si.BatchNo);
                cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
                rowNumber++;
                count++;
                pm_total += si.AMOUNT;
            }

            //set last AMOUNT cell border
            cell = ws.Cell("F" + (rowNumber - 1));
            cell.Style.Border.BottomBorder = XLBorderStyleValues.Thin;

            cell = ws.Cell("A" + rowNumber).SetValue("Total Packaging Materials Cost");
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("F" + rowNumber).SetValue(pm_total);
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            PM_TOTAL_CELL = cell.Address;//get pm total cell address

            rowNumber++;
            rowNumber++;

            foreach (MATERIALCONSUMPTIONRESULT si in fgList)
            {

                cell = ws.Cell("A" + rowNumber).SetValue(si.STOCKCODE);
                cell = ws.Cell("B" + rowNumber).SetValue(si.DESCRIPTION);
                cell = ws.Cell("C" + rowNumber).SetValue(si.QTY);
                if ((si.QTY - Math.Truncate(si.QTY)) > 0)
                {
                    cell.Style.NumberFormat.Format = "#,##0.00";
                }
                else
                {
                    cell.Style.NumberFormat.Format = "#,##0";
                }


                cell = ws.Cell("D" + rowNumber).SetValue(si.UOM);
                cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);

                if (si.COST > 0)
                {
                    cell = ws.Cell("E" + rowNumber).SetValue(si.COST);
                    cell.Style.NumberFormat.Format = "#,##0.00000000";
                }
                else
                {
                    cell = ws.Cell("E" + rowNumber).SetValue("-");
                    cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
                }
                cell = ws.Cell("F" + rowNumber).SetValue(si.AMOUNT);
                cell.Style.NumberFormat.Format = "#,##0.00";
                //cell = ws.Cell("G" + rowNumber).SetValue(si.REFNO);
                //cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);
                //cell = ws.Cell("H" + rowNumber).SetValue(si.DATEISSUED);
                //cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
                cell = ws.Cell("I" + rowNumber).SetValue(si.BatchNo);
                cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
                rowNumber++;
                count++;
                fg_total += si.AMOUNT;
            }
            //set last AMOUNT cell border
            cell = ws.Cell("F" + (rowNumber - 1));
            cell.Style.Border.BottomBorder = XLBorderStyleValues.Thin;

            cell = ws.Cell("A" + rowNumber).SetValue("Total Finished Goods Cost");
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("F" + rowNumber).SetValue(fg_total);
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            PM_TOTAL_CELL = cell.Address;//get pm total cell address

            rowNumber++;
            cell = ws.Cell("A" + (++rowNumber)).SetValue("FINISHED GOODS RECONCILIATION");
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;

            cell = ws.Cell("C" + (rowNumber)).SetValue("UOM");
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;

            cell = ws.Cell("D" + (rowNumber)).SetValue("SUMMARY");
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("E" + (rowNumber)).SetValue("Per Batch");
            cell.Style.Font.Bold = true;
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);
            cell = ws.Cell("F" + (rowNumber)).SetValue("Per Unit");
            cell.Style.Font.Bold = true;
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Right);


            cell = ws.Cell("A" + (++rowNumber)).SetValue("Finished Goods Produce");
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("B" + (rowNumber)).SetValue(FGP_QTY);
            cell.Style.Font.FontColor = XLColor.Blue;

            cell.Style.NumberFormat.Format = "#,##0.000";
            FGP_QTY_CELL = cell.Address;//get FGP_QTY cell address
            cell = ws.Cell("C" + (rowNumber)).SetValue(FGP_UOM);
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("A" + (++rowNumber)).SetValue("Retention Sample");
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("B" + (rowNumber)).SetValue(RETENTION_QTY);
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.NumberFormat.Format = "#,##0.000";
            RETENTION_QTY_CELL = cell.Address;//get RETENTION_QTY cell address
            cell = ws.Cell("C" + (rowNumber)).SetValue(RETENTION_UOM);
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("A" + (++rowNumber)).SetValue("Stability Sample");
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("B" + (rowNumber)).SetValue(STABILITY_QTY);
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.NumberFormat.Format = "#,##0.000";
            STABILITY_QTY_CELL = cell.Address;//get STABILITY_QTY_CELL cell address
            cell = ws.Cell("C" + (rowNumber)).SetValue(STABILITY_UOM);
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("A" + (++rowNumber)).SetValue("Finished Goods Available for Sale");
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("B" + (rowNumber)).SetValue(FGP_QTY - (RETENTION_QTY + STABILITY_QTY));
            cell.FormulaA1 = (FGP_QTY_CELL.ToString()) + "-(" + RETENTION_QTY_CELL.ToString() + "+" + STABILITY_QTY_CELL.ToString() + ")";
            cell.Style.NumberFormat.Format = "#,##0.000";
            FG_AVAILABLE_FOR_SALE_CELL = cell.Address;

            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.NumberFormat.Format = "#,##0.000";
            cell = ws.Cell("C" + (rowNumber)).SetValue(FGP_UOM);
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.NumberFormat.Format = "#,##0.000";
            cell = ws.Cell("A" + (++rowNumber)).SetValue("Toll Fee Rate");
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("B" + (rowNumber)).SetValue(0);
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.NumberFormat.Format = "#,##0.000";
            TOLL_FEE_CELL = cell.Address;

            int newrownum = rowNumber - 4;
            cell = ws.Cell("D" + (newrownum)).SetValue("Raw Materials Cost");
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("E" + (newrownum));
            cell.FormulaA1 = RM_TOTAL_CELL.ToString();
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.NumberFormat.Format = "#,##0.00";
            RM_COST_PER_BATCH = cell.Address;
            cell = ws.Cell("F" + (newrownum));
            cell.FormulaA1 = RM_COST_PER_BATCH.ToString() + "/" + FG_AVAILABLE_FOR_SALE_CELL.ToString();
            cell.Style.NumberFormat.Format = "#,##0.00";
            cell.Style.Font.FontColor = XLColor.Blue;
            RM_COST_PER_UNIT = cell.Address;

            cell = ws.Cell("D" + (++newrownum)).SetValue("Packaging Materials Cost");
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("E" + (newrownum));
            cell.FormulaA1 = PM_TOTAL_CELL.ColumnLetter + PM_TOTAL_CELL.RowNumber;
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.NumberFormat.Format = "#,##0.00";
            PM_COST_PER_BATCH = cell.Address;
            cell = ws.Cell("F" + (newrownum));
            cell.FormulaA1 = PM_COST_PER_BATCH.ToString() + "/" + FG_AVAILABLE_FOR_SALE_CELL.ToString();
            cell.Style.NumberFormat.Format = "#,##0.00";
            cell.Style.Font.FontColor = XLColor.Blue;
            PM_COST_PER_UNIT = cell.Address;


            cell = ws.Cell("D" + (++newrownum)).SetValue("Assay Fee");
            cell.Style.Font.FontColor = XLColor.Blue;

            cell = ws.Cell("E" + (newrownum)).SetValue(0);
            cell.Style.NumberFormat.Format = "#,##0.00";
            cell.Style.Font.FontColor = XLColor.Blue;
            ASSAY_FEE = cell.Address;

            cell = ws.Cell("F" + (newrownum));
            cell.FormulaA1 = ASSAY_FEE.ToString() + "/" + FG_AVAILABLE_FOR_SALE_CELL.ToString();
            cell.Style.NumberFormat.Format = "#,##0.00";
            cell.Style.Font.FontColor = XLColor.Blue;


            cell = ws.Cell("D" + (++newrownum)).SetValue("Toll Fee");
            cell.Style.Font.FontColor = XLColor.Blue;
            cell = ws.Cell("E" + (newrownum));
            cell.FormulaA1 = TOLL_FEE_CELL.ToString() + "*" + FGP_QTY_CELL.ToString();
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Border.BottomBorder = XLBorderStyleValues.Thin;
            TOLL_FEE_PER_BATCH = cell.Address;
            cell = ws.Cell("F" + (+newrownum));
            cell.FormulaA1 = TOLL_FEE_PER_BATCH.ToString() + "/" + FG_AVAILABLE_FOR_SALE_CELL.ToString();
            cell.Style.Border.BottomBorder = XLBorderStyleValues.Thin;
            cell.Style.NumberFormat.Format = "#,##0.00";
            cell.Style.Font.FontColor = XLColor.Blue;
            TOLL_FEE_PER_UNIT = cell.Address;



            cell = ws.Cell("D" + (++newrownum)).SetValue("TOTAL COST");
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Font.Bold = true;
            cell = ws.Cell("E" + (newrownum));
            cell.FormulaA1 = "SUM(" + RM_COST_PER_BATCH.ToString() + ":" + TOLL_FEE_PER_BATCH.ToString() + ")";
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            cell = ws.Cell("F" + (newrownum));
            cell.FormulaA1 = "SUM(" + RM_COST_PER_UNIT.ToString() + ":" + TOLL_FEE_PER_UNIT.ToString() + ")";
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            TOTAL_PER_UNIT = cell.Address;

            rowNumber++;
            cell = ws.Cell("A" + (++rowNumber)).SetValue("Desired Gross Profit");
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Font.Bold = true;

            cell = ws.Cell("C" + (rowNumber));
            cell.FormulaA1 = "((" + TOTAL_PER_UNIT.ToString() + "/0.65)- " + TOTAL_PER_UNIT.ToString() + ")/(" + TOTAL_PER_UNIT.ToString() + "/0.65)";
            cell.Style.NumberFormat.Format = "0.0%";
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Font.Bold = true;

            cell = ws.Cell("D" + (rowNumber)).SetValue("10+1");
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);
            cell.Style.Font.FontColor = XLColor.Red;
            cell.Style.Font.Bold = true;

            cell = ws.Cell("E" + (rowNumber)).SetValue("10+2");
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);
            cell.Style.Font.FontColor = XLColor.Red;
            cell.Style.Font.Bold = true;

            cell = ws.Cell("F" + (rowNumber)).SetValue("10+3");
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);
            cell.Style.Font.FontColor = XLColor.Red;
            cell.Style.Font.Bold = true;

            cell = ws.Cell("G" + (rowNumber)).SetValue("10+4");
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);
            cell.Style.Font.FontColor = XLColor.Red;
            cell.Style.Font.Bold = true;

            cell = ws.Cell("H" + (rowNumber)).SetValue("10+5");
            cell.Style.Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);
            cell.Style.Font.FontColor = XLColor.Red;
            cell.Style.Font.Bold = true;



            IXLAddress WITHVAT;
            IXLAddress DVAT;
            IXLAddress EVAT;
            IXLAddress FVAT;
            IXLAddress GVAT;
            IXLAddress HVAT;



            IXLAddress CurrentWITHVAT;
            IXLAddress CurrentDVAT;
            IXLAddress CurrentEVAT;
            IXLAddress CurrentFVAT;
            IXLAddress CurrentGVAT;
            IXLAddress CurrentHVAT;

            cell = ws.Cell("A" + (++rowNumber)).SetValue("SRP (to get 35% GP) - VAT Inclusive");
            cell.Style.Font.FontColor = XLColor.Red;
            cell.Style.Font.Bold = true;

            cell = ws.Cell("C" + (rowNumber));
            cell.FormulaA1 = "(((" + TOTAL_PER_UNIT.ToString() + "/0.65)*15/10)*1.12)";
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            WITHVAT = cell.Address;


            cell = ws.Cell("D" + (rowNumber));
            cell.FormulaA1 = WITHVAT.ToString() + " * 10 / 11";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            DVAT = cell.Address;

            cell = ws.Cell("E" + (rowNumber));
            cell.FormulaA1 = WITHVAT.ToString() + " * 10 / 12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            EVAT = cell.Address;

            cell = ws.Cell("F" + (rowNumber));
            cell.FormulaA1 = WITHVAT.ToString() + " * 10 / 13";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            FVAT = cell.Address;

            cell = ws.Cell("G" + (rowNumber));
            cell.FormulaA1 = WITHVAT.ToString() + " * 10 / 14";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            GVAT = cell.Address;

            cell = ws.Cell("H" + (rowNumber));
            cell.FormulaA1 = WITHVAT.ToString() + " * 10 / 15";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            HVAT = cell.Address;




            //
            cell = ws.Cell("A" + (++rowNumber)).SetValue("SRP(to get 35 % GP) - VAT Exclusive");
            cell.Style.Font.FontColor = XLColor.Red;
            cell.Style.Font.Bold = true;

            IXLAddress CVAT35EXCLUSIVE;
            cell = ws.Cell("C" + (rowNumber));
            cell.FormulaA1 = WITHVAT.ToString() + " / 1.12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            CVAT35EXCLUSIVE = cell.Address;

            cell = ws.Cell("D" + (rowNumber));
            cell.FormulaA1 = DVAT.ToString() + " / 1.12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";


            cell = ws.Cell("E" + (rowNumber));
            cell.FormulaA1 = EVAT.ToString() + " / 1.12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";


            cell = ws.Cell("F" + (rowNumber));
            cell.FormulaA1 = FVAT.ToString() + " / 1.12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";


            cell = ws.Cell("G" + (rowNumber));
            cell.FormulaA1 = GVAT.ToString() + " / 1.12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";

            IXLAddress H35EXCLUSIVE;
            cell = ws.Cell("H" + (rowNumber));
            cell.FormulaA1 = HVAT.ToString() + " / 1.12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            H35EXCLUSIVE = cell.Address;

            cell = ws.Cell("I" + (rowNumber));
            cell.FormulaA1 = "(" + H35EXCLUSIVE.ToString() + "-" + TOTAL_PER_UNIT.ToString() + ")/" + H35EXCLUSIVE.ToString();
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Font.Bold = true;

            rowNumber++;
            cell = ws.Cell("D" + (++rowNumber)).SetValue("Existing Pricing Logistics");
            var range = ws.Range("D" + rowNumber + ":H" + rowNumber + "");
            range.Merge().Style.Font.SetBold().Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);

            cell = ws.Cell("A" + (++rowNumber)).SetValue("CURRENT SRP - VAT INCLUSIVE");
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Font.Bold = true;

            cell = ws.Cell("C" + (rowNumber)).SetValue(0);
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            CurrentWITHVAT = cell.Address;


            cell = ws.Cell("D" + (rowNumber));
            cell.FormulaA1 = CurrentWITHVAT.ToString() + " * 10 / 11";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            CurrentDVAT = cell.Address;

            cell = ws.Cell("E" + (rowNumber));
            cell.FormulaA1 = CurrentWITHVAT.ToString() + " * 10 / 12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            CurrentEVAT = cell.Address;

            cell = ws.Cell("F" + (rowNumber));
            cell.FormulaA1 = CurrentWITHVAT.ToString() + " * 10 / 13";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            CurrentFVAT = cell.Address;

            cell = ws.Cell("G" + (rowNumber));
            cell.FormulaA1 = CurrentWITHVAT.ToString() + " * 10 / 14";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            CurrentGVAT = cell.Address;

            cell = ws.Cell("H" + (rowNumber));
            cell.FormulaA1 = CurrentWITHVAT.ToString() + " * 10 / 15";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            CurrentHVAT = cell.Address;

            cell = ws.Cell("A" + (++rowNumber)).SetValue("CURRENT SRP - VAT EXCLUSIVE");
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Font.Bold = true;

            IXLAddress CURRENTVATEXCLUSIVE;

            cell = ws.Cell("C" + (rowNumber));
            cell.FormulaA1 = CurrentWITHVAT.ToString() + " / 1.12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            CURRENTVATEXCLUSIVE = cell.Address;

            cell = ws.Cell("D" + (rowNumber));
            cell.FormulaA1 = CurrentDVAT.ToString() + " / 1.12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";


            cell = ws.Cell("E" + (rowNumber));
            cell.FormulaA1 = CurrentEVAT.ToString() + " / 1.12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";


            cell = ws.Cell("F" + (rowNumber));
            cell.FormulaA1 = CurrentFVAT.ToString() + " / 1.12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";


            cell = ws.Cell("G" + (rowNumber));
            cell.FormulaA1 = CurrentGVAT.ToString() + " / 1.12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";

            IXLAddress HCURRENTEXCLUSIVE;
            cell = ws.Cell("H" + (rowNumber));
            cell.FormulaA1 = CurrentHVAT.ToString() + " / 1.12";
            cell.Style.Font.Bold = true;
            cell.Style.NumberFormat.Format = "#,##0.00";
            HCURRENTEXCLUSIVE = cell.Address;

            cell = ws.Cell("I" + (rowNumber));
            cell.FormulaA1 = "(" + HCURRENTEXCLUSIVE.ToString() + "-" + TOTAL_PER_UNIT.ToString() + ")/" + HCURRENTEXCLUSIVE.ToString();
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.NumberFormat.Format = "#,##0.00";
            cell.Style.Font.Bold = true;

            cell = ws.Cell("A" + (++rowNumber)).SetValue("Percentage Margin Under Present Pricing Logistics");
            cell.Style.Font.Bold = true;
            cell.Style.Font.FontColor = XLColor.Blue;

            cell = ws.Cell("C" + (rowNumber));
            cell.FormulaA1 = "(((" + CurrentWITHVAT.ToString() + "*10/15)/1.12-" + TOTAL_PER_UNIT.ToString() + ")/((" + CurrentWITHVAT.ToString() + "*10/15)/1.12))";
            cell.Style.NumberFormat.Format = "0.0%";
            cell.Style.Font.FontColor = XLColor.Blue;
            cell.Style.Font.Bold = true;
            rowNumber++;

            cell = ws.Cell("A" + (++rowNumber)).SetValue("Recommended % Price Increase from Present Pricing Logistics");
            var range2 = ws.Range("A" + rowNumber + ":B" + rowNumber + "");
            range2.Merge().Style.Font.SetBold().Alignment.SetHorizontal(XLAlignmentHorizontalValues.Center);
            cell.Style.Font.FontColor = XLColor.Red;
            //Recommended % Price Increase from Present Pricing Logistics

            cell = ws.Cell("C" + (rowNumber));
            cell.FormulaA1 = "(" + CVAT35EXCLUSIVE.ToString() + "/" + CURRENTVATEXCLUSIVE.ToString() + ")-1";
            cell.Style.NumberFormat.Format = "0.0%";
            cell.Style.Font.FontColor = XLColor.Red;
            cell.Style.Font.Bold = true;



            rowNumber += 2;
            cell = ws.Cell("A" + (++rowNumber)).SetValue("Prepared By:");
            cell.Style.Font.FontColor = XLColor.Blue;


            cell = ws.Cell("C" + (rowNumber)).SetValue("Checked By:");
            cell.Style.Font.FontColor = XLColor.Blue;


            cell = ws.Cell("F" + (rowNumber)).SetValue("Approved By:");
            cell.Style.Font.FontColor = XLColor.Blue;





            //COLUMN WIDTH ADJUSTMENTS
            ws.Column("A").Width = 16;
            ws.Column("B").Width = 32;
            ws.Column("C").Width = 16;
            ws.Column("D").Width = 11;
            ws.Column("E").Width = 14;
            ws.Column("F").Width = 14;
            ws.Column("G").Width = 20;
            ws.Column("H").Width = 14;
            ws.Column("I").Width = 14;

            if (wb.Worksheets.Count > 0)
            {
                MemoryStream ms = GetStream(wb);
                byte[] bytes = ms.ToArray();
                ms.Close();

                await js.SaveAsFileAsync("BATCHBYBALANCEDEVAILS", bytes, "application/vnd.ms-excel");
            }
            else
            {
                await js.InvokeVoidAsync("alert", "No record found.");
            }


        }

    }
    private MemoryStream GetStream(XLWorkbook excelWorkbook)
    {
        MemoryStream fs = new MemoryStream();
        excelWorkbook.SaveAs(fs);
        fs.Position = 0;
        return fs;
    }
    private async Task AppState_StateChanged(ComponentBase Source, string Property)
    {
        if (Source != this)
        {
            if (AppState.CompanyReady())
            {
                await LoadData();
            }
            await InvokeAsync(StateHasChanged);
        }
    }
    protected override void OnInitialized()
    {
        AppState.StateChanged += async (Source, Property) => await AppState_StateChanged(Source, Property);
    }
    void IDisposable.Dispose()
    {
        AppState.StateChanged -= async (Source, Property) => await AppState_StateChanged(Source, Property);
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime js { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private HttpClient http { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AppState AppState { get; set; }
    }
}
namespace __Blazor.ICV2_Web.Pages.Qne.MaterialConsumption
{
    #line hidden
    internal static class TypeInference
    {
        public static void CreateInputSelect_0<TValue>(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder, int seq, int __seq0, System.Object __arg0, int __seq1, global::System.Object __arg1, int __seq2, System.Object __arg2, int __seq3, TValue __arg3, int __seq4, global::Microsoft.AspNetCore.Components.EventCallback<TValue> __arg4, int __seq5, global::System.Linq.Expressions.Expression<global::System.Func<TValue>> __arg5, int __seq6, global::Microsoft.AspNetCore.Components.RenderFragment __arg6)
        {
        __builder.OpenComponent<global::Microsoft.AspNetCore.Components.Forms.InputSelect<TValue>>(seq);
        __builder.AddAttribute(__seq0, "id", __arg0);
        __builder.AddAttribute(__seq1, "oninput", __arg1);
        __builder.AddAttribute(__seq2, "class", __arg2);
        __builder.AddAttribute(__seq3, "Value", __arg3);
        __builder.AddAttribute(__seq4, "ValueChanged", __arg4);
        __builder.AddAttribute(__seq5, "ValueExpression", __arg5);
        __builder.AddAttribute(__seq6, "ChildContent", __arg6);
        __builder.CloseComponent();
        }
        public static void CreateInputSelect_1<TValue>(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder, int seq, int __seq0, System.Object __arg0, int __seq1, System.Object __arg1, int __seq2, TValue __arg2, int __seq3, global::Microsoft.AspNetCore.Components.EventCallback<TValue> __arg3, int __seq4, global::System.Linq.Expressions.Expression<global::System.Func<TValue>> __arg4, int __seq5, global::Microsoft.AspNetCore.Components.RenderFragment __arg5)
        {
        __builder.OpenComponent<global::Microsoft.AspNetCore.Components.Forms.InputSelect<TValue>>(seq);
        __builder.AddAttribute(__seq0, "id", __arg0);
        __builder.AddAttribute(__seq1, "class", __arg1);
        __builder.AddAttribute(__seq2, "Value", __arg2);
        __builder.AddAttribute(__seq3, "ValueChanged", __arg3);
        __builder.AddAttribute(__seq4, "ValueExpression", __arg4);
        __builder.AddAttribute(__seq5, "ChildContent", __arg5);
        __builder.CloseComponent();
        }
    }
}
#pragma warning restore 1591
