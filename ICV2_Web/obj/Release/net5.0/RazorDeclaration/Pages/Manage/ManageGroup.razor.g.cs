// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace ICV2_Web.Pages.Manage
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using ICV2_Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using ICV2_Web.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using ICV2_Web.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using ICV2_Web.Authentication;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using ICV2_Web.Pages;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using DataAccessLibrary.Models.QneModels;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using DataAccessLibrary.Models.QneReportFilter;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using DataAccessLibrary.Models.QneReportResult;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using DataAccessLibrary.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using DataAccessLibrary;

#line default
#line hidden
#nullable disable
#nullable restore
#line 21 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Blazorise;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Blazorise.Icons;

#line default
#line hidden
#nullable disable
#nullable restore
#line 23 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using Blazorise.Sidebar;

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using ICV2_Web.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 28 "F:\Blazor\InventoryControlV2\ICV2_Web\_Imports.razor"
using NEvaldas.Blazor.Select2;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Manage\ManageGroup.razor"
using System.Text.Json;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/usergroup")]
    public partial class ManageGroup : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 263 "F:\Blazor\InventoryControlV2\ICV2_Web\Pages\Manage\ManageGroup.razor"
               
            private Modal modalManage;
            private Modal modalRef;
            private Modal modalUserRef;

            //private UserModel DDLUserSelected;
            //private int SelectedUserId;
            private int SelectedGroupId = 0;
            private string selectedGroupName = string.Empty;
            Group selectedGroup = new();
            private MenuAccess MenuAccessModel = new();

            private List<MenuAccess> menuAccesses { get; set; } = new List<MenuAccess>();
            private List<UserModel> users { get; set; } = new List<UserModel>();
            private List<MenuInfo> menuList { get; set; } = new List<MenuInfo>();
            private List<AssignedMenu> assignedMenus { get; set; } = new List<AssignedMenu>();

            private List<UsersInGroup> usersInGroups { get; set; } = new List<UsersInGroup>();

            Group model = new();
            private string title { get; set; }
            private List<Group> groups { get; set; } = new List<Group>();
            private async Task RemoveAssigned(AssignedMenu assignedMenu)
            {
                var httprequest = await http.PostAsJsonAsync("api/Navigation/UnAssigMenu", assignedMenu);
                if (httprequest.IsSuccessStatusCode)
                {
                    assignedMenus.RemoveAll(x => x.GroupedMenuId == assignedMenu.GroupedMenuId);

                    var responseString = await httprequest.Content.ReadAsStringAsync();

                    var data = JsonSerializer.Deserialize<MenuInfo>(responseString,
                        new JsonSerializerOptions() { PropertyNameCaseInsensitive = true });

                    menuList.Add(data);
                }
            }
            private async Task Assign(int menuId,string MenuName)
            {
                GroupedMenu model = new GroupedMenu
                {
                    GroupId = SelectedGroupId,
                    MenuId = menuId
                };

                //Console.WriteLine("GROUP ID IS : " + model.GroupId);
                //Console.WriteLine("MENU ID IS : " + model.MenuId);

                var httpRequest = await http.PostAsJsonAsync("api/Navigation/AssignMenu", model);
                if (httpRequest.IsSuccessStatusCode)
                {
                    var content = await httpRequest.Content.ReadAsStringAsync();

                    menuList.RemoveAll(x => x.MenuId == menuId);

                    assignedMenus.Add(new AssignedMenu
                    {
                        GroupedMenuId = Convert.ToInt32(content),
                        MenuName=MenuName,
                        MenuId = menuId
                    });
                    //assignedMenus = await http.GetFromJsonAsync<List<AssignedMenu>>("api/Navigation/GetAssignedMenuByGroupId?GroupedId=" + groupid);
                    //assignedMenus.Add(model);
                }
            }
            private async Task AddUserToGroup()
            {
                //Console.WriteLine(MenuAccessModel.UserId);
                if (MenuAccessModel.GroupId > 0 && MenuAccessModel.UserId > 0)
                {
                    var name = users.Find(x => x.Id == MenuAccessModel.UserId).Name;

                    if(!string.IsNullOrEmpty(name)){
                        MenuAccessModel.Name = name;
                    }

                    var httpResponse = await http.PostAsJsonAsync("api/Navigation/InserUserToGroup", MenuAccessModel);
                    if (httpResponse.IsSuccessStatusCode)
                    {
                        var content = await httpResponse.Content.ReadAsStringAsync();

                        var newModel = new MenuAccess
                        {
                            MenuAccessId = Convert.ToInt32(content),
                            GroupId = MenuAccessModel.GroupId,
                            Name = MenuAccessModel.Name,
                            UserId = MenuAccessModel.UserId
                        };
                        await LoadUsersInGroup();
                        menuAccesses.Add(newModel);

                        users.RemoveAll(x => x.Id == newModel.UserId);

                        MenuAccessModel.UserId = 0;
                        this.StateHasChanged();
                    }

                    //Console.WriteLine(SelectedUserId);
                }
                else
                {
                    await js.InvokeVoidAsync("alert", "Please select user.");
                }
            }

            private async Task RemoveUserToGrup(MenuAccess menuAccess)
            {

                if (menuAccess.GroupId > 0 && menuAccess.UserId > 0)
                {

                    var httpResponse = await http.PostAsJsonAsync("api/Navigation/DeleteUserToGroup", menuAccess);
                    if (httpResponse.IsSuccessStatusCode)
                    {
                        menuAccesses.Remove(menuAccess);
                        users = await http.GetFromJsonAsync<List<UserModel>>("api/User/GetUserWithoutGroup");
                        await LoadUsersInGroup();
                        //MenuAccessModel.UserId = 0;
                        this.StateHasChanged();
                    }

                    //Console.WriteLine(SelectedUserId);
                }
                else
                {
                    await js.InvokeVoidAsync("alert", "Please select user.");
                }
            }
            private async Task ShowUserForGroupForm(int groupid)
            {
                users = await http.GetFromJsonAsync<List<UserModel>>("api/User/GetUserWithoutGroup");

                var httprequest = await http.GetAsync("api/Navigation/GetUsersOnGroup?GroupId=" + groupid);

                if (httprequest.IsSuccessStatusCode)
                {
                    var httpContent = await httprequest.Content.ReadAsStringAsync();

                    menuAccesses = JsonSerializer.Deserialize<List<MenuAccess>>(httpContent,
                         new JsonSerializerOptions() { PropertyNameCaseInsensitive = true });
                }

                //if (menuAccesses != null)
                //{

                //    foreach (var item in menuAccesses)
                //    {
                //        if (users != null && users.Count > 0)
                //        {
                //            var profileName = users.Find(x => x.Id == item.UserId).Name;

                //            if (profileName is not null)
                //            {
                //                item.Name = profileName;
                //                users.RemoveAll(x => x.Id == item.UserId);
                //            }
                //        }
                //    }
                //}



                SelectedGroupId = groupid;
                MenuAccessModel.GroupId = SelectedGroupId;

                modalUserRef.Show();
            }
            private async Task ShowManageForm(int GroupId,string groupName)
            {
                this.SelectedGroupId = GroupId;
                this.selectedGroupName = groupName;
                if (this.SelectedGroupId > 0) {
                    assignedMenus = await http.GetFromJsonAsync<List<AssignedMenu>>("api/Navigation/GetAssignedMenuByGroupId?GroupedId=" + GroupId);
                    modalManage.Show();

                    menuList = await http.GetFromJsonAsync<List<MenuInfo>>("api/Navigation/GetNavMenu");

                    if (assignedMenus.Count > 0)
                    {
                        foreach(var item in assignedMenus)
                        {
                            menuList.RemoveAll(x => x.MenuId == item.MenuId);
                        }
                    }


                }

            }

            private void ShowGroupForm(Group modelselected, bool IsEdit)
            {
                if (!IsEdit)
                {
                    title = "Add new group";
                }
                else
                {
                    title = "Update group";

                    selectedGroup = new Group
                    {
                        GroupId = modelselected.GroupId,
                        Name = modelselected.Name,
                        IsActive = modelselected.IsActive
                    };

                    this.model = selectedGroup;
                }
                modalRef.Show();
            }
            private async Task SubmitForm()
            {

                var httpRequest = await http.PostAsJsonAsync("api/Navigation/SaveGroup", model);
                if (httpRequest.IsSuccessStatusCode)
                {
                    await LoadData();
                    model = new();
                    modalRef.Hide();
                }
                //Console.WriteLine(model.IsActive);
            }
            private void HideModal()
            {
                model = new();
                modalRef.Hide();
                selectedGroup = new();

                //if (userSelected.Id > 0 && index > -1)
                //{
                //    users.Insert(index, userSelected);
                //}

            }

            protected override async Task OnInitializedAsync()
            {
                await LoadData();
            }

            private async Task LoadData()
            {

                groups = await http.GetFromJsonAsync<List<Group>>("api/Navigation/GetGroups");

                await LoadUsersInGroup();
            }
            private async Task LoadUsersInGroup()
            {
                if (groups != null)
                {
                    usersInGroups = await http.GetFromJsonAsync<List<UsersInGroup>>("api/Navigation/CountUsersInGroup");
                }
            }
        

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime js { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private HttpClient http { get; set; }
    }
}
#pragma warning restore 1591
